"use strict";angular.module("mctApp",["ngRoute","ngSanitize","ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/posts",{templateUrl:"views/posts/index.html",controller:"PostsCtrl"}).when("/posts/new",{templateUrl:"views/posts/new.html",controller:"NewPostCtrl"}).when("/posts/:name",{templateUrl:"views/posts/show.html",controller:"ShowPostCtrl"}).when("/posts/:name/edit",{templateUrl:"views/posts/edit.html",controller:"EditPostCtrl"}).when("/experiments/maze",{templateUrl:"views/experiments/maze.html",controller:"MazeCtrl"}).when("/experiments/cloth",{templateUrl:"views/experiments/cloth.html",controller:"ClothCtrl"}).when("/chemistry",{templateUrl:"views/chemistry/chemistry.html",controller:"ChemistryCtrl"}).when("/chemistry/periodictable",{templateUrl:"views/chemistry/periodictable.html",controller:"PeriodicTableCtrl"}).when("/mc3",{templateUrl:"views/mc3/mc3.html",controller:"Mc3Ctrl"}).when("/mc3/matrix4",{templateUrl:"views/mc3/matrix4.html",controller:"Matrix4Ctrl"}).when("/mc3/world",{templateUrl:"views/mc3/world.html",controller:"WorldCtrl"}).when("/mc3/webgl",{templateUrl:"views/mc3/mc3gl.html",controller:"Mc3GLCtrl"}).when("/mc3/maze",{templateUrl:"views/mc3/mazegl.html",controller:"MazeGLCtrl"}).when("/mc3/cube",{templateUrl:"views/mc3/cube.html",controller:"CubeCtrl"}).when("/chemistry/sketcher",{templateUrl:"views/chemistry/sketcher.html",controller:"SketcherCtrl"}).when("/chemistry/sketcher/:name",{templateUrl:"views/chemistry/sketcher.html",controller:"SketcherCtrl"}).when("/chemistry/renderer",{templateUrl:"views/chemistry/renderer.html",controller:"RendererCtrl"}).when("/chemistry/renderer/:name",{templateUrl:"views/chemistry/renderer.html",controller:"RendererCtrl"}).when("/chemistry/grapher",{templateUrl:"views/chemistry/grapher.html",controller:"GrapherCtrl"}).when("/webgl",{templateUrl:"views/webgl/webgl.html",controller:"WebGLCtrl"}).when("/grapher",{templateUrl:"views/grapher.html",controller:"GrapherCtrl"}).when("/webgl/world",{templateUrl:"views/webgl/glworld.html",controller:"GLWorldCtrl"}).when("/webgl/test",{templateUrl:"views/webgl/testmatrix.html",controller:"TestMatrixCtrl"}).when("/audio",{templateUrl:"views/audio/audio.html",controller:"AudioCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("mctApp").controller("MainCtrl",["$scope","$location",function(a,b){a.$location=b,a.$watch("$location.path()",function(b){a.activeNavId=b||"/"}),a.getClass=function(b){return a.activeNavId?a.activeNavId.substring(0,b.length)===b?"active":"":void 0}}]),angular.module("mctApp").controller("PostsCtrl",["$scope","Post","Tag",function(a,b,c){a.query="",a.selectedTags=[],a.init=function(){a.getTags(),a.getPosts()},a.getTagClass=function(b){var c=a.selectedTags.indexOf(b)>=0?"active":"";return c},a.toggleTag=function(b){var c=a.selectedTags.indexOf(b);c>=0?a.selectedTags.splice(c,1):a.selectedTags.push(b),console.log(a.selectedTags)},a.getTags=function(){a.tags=c.query()},a.getPosts=function(){a.posts=b.query()};var d=new Showdown.converter;a.parseContent=function(a){return d.makeHtml(a)}}]),angular.module("mctApp").controller("NewPostCtrl",["$scope","$location","Post",function(a,b,c){a.post={title:"",tags:null,content:""},a.preview="";var d=new Showdown.converter;a.$watch("post.content",function(){a.post.content&&(a.preview=d.makeHtml(a.post.content))}),a.parseContent=function(b){b&&(a.preview=d.makeHtml(b))},a.savePost=function(){var d=new c(a.post);d.$save(),b.path("/posts")}}]),angular.module("mctApp").controller("EditPostCtrl",["$scope","$location","$routeParams","Post",function(a,b,c,d){a.post=d.get({name:c.name});var e=new Showdown.converter;a.$watch("post.content",function(){a.post.content&&(a.preview=e.makeHtml(a.post.content))}),a.savePost=function(){a.post.$save(),b.path("/posts")}}]),angular.module("mctApp").controller("ShowPostCtrl",["$scope","Post","$location","$routeParams",function(a,b,c,d){a.post=b.get({name:d.name});var e=new Showdown.converter;a.$watch("post.content",function(){a.post.content&&(a.content=e.makeHtml(a.post.content))}),a.editPost=function(){c.path("/posts/"+a.post.urlString+"/edit")},a.deletePost=function(){a.post.$delete(),c.path("/posts")}}]),angular.module("mctApp").factory("Post",["$resource",function(a){return a("posts/:name",{name:"@urlString"},{})}]),angular.module("mctApp").factory("Tag",["$resource",function(a){return a("tags/:name",{name:"@urlString"},{})}]),angular.module("mctApp").controller("MazeCtrl",["$scope","Maze","MazeStore",function(a,b,c){a.rows=10,a.columns=10,a.mazes=c.query(),a.init=function(){var c=angular.element(document.getElementById("maze-canvas"))[0];c.width=700,c.height=700,a.maze=new b(c,a.columns,a.rows),a.canvas=c},a.initDemo=function(c){a.maze=a.maze||new b(c,a.columns,a.rows)},a.deleteMaze=function(b){var d=window.confirm("Delete maze: "+b.name);return d?(b.$delete(),a.mazes=c.query(),!1):void 0},a.activeMaze=function(b){return b===a.mazeStore?"active":""},a.saveMaze=function(){var b=a.maze.generateConfig();if(b){if(a.mazeStore)a.mazeStore.config=b,a.mazeStore.$save();else{var d=new c({name:a.name,config:b});d.$save()}a.mazes=c.query()}},a.loadMaze=function(b){a.mazeStore=b,a.name=b.name;var c=JSON.parse(b.config);a.maze.load(c),a.columns=a.maze.columns,a.rows=a.maze.rows},a.solve=function(){a.maze.solve()},a.stop=function(){a.maze.stop()},a.handleMouseDown=function(b){var c=a.maze.cellWidth,d=a.maze.cellHeight,e=Math.floor((b.offsetX-1)/c),f=Math.floor((b.offsetY-1)/d),g=a.maze.findCell(e,f);if(a.maze.startSelection)return a.maze.startSelection=!1,void 0;if(a.maze.endSelection)return a.maze.endSelection=!1,void 0;var h=b.offsetX-g.column*c,i=(g.column+1)*c-b.offsetX,j=b.offsetY-g.row*d,k=(g.row+1)*d-b.offsetY,l={left:h,right:i,top:j,bottom:k},m=a.findLowestDelta(l);g.removeWall(m),a.maze.draw()},a.handleMouseMove=function(b){var c=a.maze.cellWidth,d=a.maze.cellHeight,e=Math.floor(b.offsetX/c),f=Math.floor(b.offsetY/d),g=a.maze.findCell(e,f);a.maze.startSelection&&(a.maze.start=g),a.maze.endSelection&&(a.maze.end=g),a.maze.draw()},a.addStart=function(){a.maze.startSelection=!0},a.addEnd=function(){a.maze.endSelection=!0},a.findLowestDelta=function(a){var b=Object.keys(a).reduce(function(b,c){var d=a[c];return d<a[b]?c:b});return b}}]),angular.module("mctApp").factory("Maze",function(){var a=function(a,b){this.path=a,this.cell=b,this.cell.isBranchPoint=!0,this.branches=[]};a.prototype.getChoices=function(){var a=this.path.history;return this.branches.filter(function(b){return a.indexOf(b)<0})};var b=function(a,b){this.maze=a,this.start=b,this.history=[],this.branchPoints=[],this.cell=b;var c=this.choosePath();this.travelTo(c)};b.prototype.choosePath=function(){var b,c=[];if(this.cell.left&&(b=this.maze.findCell(this.cell.column-1,this.cell.row),this.history.indexOf(b)<0&&c.push(b)),this.cell.right&&(b=this.maze.findCell(this.cell.column+1,this.cell.row),this.history.indexOf(b)<0&&c.push(b)),this.cell.top&&(b=this.maze.findCell(this.cell.column,this.cell.row-1),this.history.indexOf(b)<0&&c.push(b)),this.cell.bottom&&(b=this.maze.findCell(this.cell.column,this.cell.row+1),this.history.indexOf(b)<0&&c.push(b)),c.length>1){var d=new a(this,this.cell);d.branches=c,this.branchPoints.push(d)}var e=c[Math.floor(Math.random()*c.length)];return e},b.prototype.travelTo=function(a){if(this.maze.solveInProgress){if(a===this.maze.end)return window.alert("Win"),this.maze.solveInProgress=!1,void 0;if(!a)for(var b=this.branchPoints[this.branchPoints.length-1],c=1;b;){if(b.getChoices().length>0)return this.maze.draw(),this.travelTo(b.cell),void 0;if(b=this.branchPoints[this.branchPoints.length-c],c>this.branchPoints.length)return window.alert("No solution found"),this.maze.solveInProgress=!1,!1;c++}this.history.push(this.cell),this.cell=a,this.cell.visited=!0;var d=this;this.maze.draw(),window.setTimeout(function(){d.travelTo(d.choosePath())},100)}};var c=function(a,b,c){this.rows=c,this.columns=b,this.defaultFill="lightsteelblue",this.startFill="lightgreen",this.endFill="red",this.branchPointFill="green",this.visitedFill="white",a&&(this.canvas=a,this.ctx=this.canvas.getContext("2d"),this.height=a.height,this.width=a.width),this.reset()};c.prototype.solve=function(){this.solveInProgress||(this.reset(),this.solveInProgress=!0,new b(this,this.start))},c.prototype.stop=function(){this.solveInProgress=!1},c.prototype.getIndex=function(a,b){return a+b*this.columns},c.prototype.findCell=function(a,b){return this.cells[a+b*this.columns]},c.prototype.generateConfig=function(){if(!this.end||!this.start)return console.log("incomplete maze"),void 0;this.changed=!1;var a=this.cells.map(function(a){return{row:a.row,column:a.column,left:a.left,right:a.right,top:a.top,bottom:a.bottom}}),b={rows:this.rows,columns:this.columns,start:{column:this.start.column,row:this.start.row},end:{column:this.end.column,row:this.end.row},cells:a};return this.loadData=b,JSON.stringify(b)},c.prototype.load=function(a){this.solveInProgress=!1,this.loadData=a,console.log(a),this.columns=a.columns,this.rows=a.rows,this.cells=new Array(this.rows*this.columns),this.cellWidth=this.canvas.width/this.columns,this.cellHeight=this.canvas.height/this.rows;var b,c=this;a.cells.forEach(function(a){b=c.addCell(a.column,a.row),b.maze=c,b.top=a.top,b.bottom=a.bottom,b.left=a.left,b.right=a.right,c.cells[c.getIndex(a.column,a.row)]=b}),this.start=this.findCell(a.start.column,a.start.row),this.end=this.findCell(a.end.column,a.end.row),this.draw()},c.prototype.reset=function(){if(this.changed)return window.alert("Reset will destroy new data"),!1;if(this.loadData)return this.load(this.loadData),void 0;var a,b,c;for(this.cellWidth=this.canvas.width/this.columns,this.cellHeight=this.canvas.height/this.rows,this.cells=new Array(this.rows*this.columns),a=0;a<this.rows;a++)for(b=0;b<this.columns;b++)c=this.addCell(b,a);this.draw()},c.prototype.addCell=function(a,b){var c=new d(a,b);return c.maze=this,this.cells[this.getIndex(a,b)]=c,c},c.prototype.draw=function(){if(this.canvas){var a=this.ctx;a.clearRect(0,0,this.width,this.height),this.cells.forEach(function(b){b.draw(a)})}};var d=function(a,b){this.column=a,this.row=b,this.fill="lightsteelblue",this.left=!1,this.right=!1,this.top=!1,this.bottom=!1};return d.prototype.removeWall=function(a){this.maze.changed=!0;var b,c=this.maze;if("left"===a){if(this.column-1<0)return;b=c.findCell(this.column-1,this.row),b&&(this.left=this.left?!1:!0,b.right=b.right?!1:!0)}if("right"===a){if(this.column+1>=c.columns)return;b=c.findCell(this.column+1,this.row),b&&(this.right=this.right?!1:!0,b.left=b.left?!1:!0)}if("top"===a){if(this.row-1<0)return;b=c.findCell(this.column,this.row-1),b&&(this.top=this.top?!1:!0,b.bottom=b.bottom?!1:!0)}if("bottom"===a){if(this.row+1>=c.rows)return;b=c.findCell(this.column,this.row+1),console.log(b),b&&(this.bottom=this.bottom?!1:!0,b.top=b.top?!1:!0)}console.log(this)},d.prototype.draw=function(a){a.lineWidth=1;var b=this.maze.cellWidth,c=this.maze.cellHeight;a.fillStyle=this.maze.start===this?this.maze.startFill:this.maze.end===this?this.maze.endFill:this.isBranchPoint?this.maze.branchPointFill:this.visited?this.maze.visitedFill:this.fill,a.beginPath(),a.fillRect(this.column*b,this.row*c,b,c),a.closePath(),this.left||(a.strokeStyle=this.leftColor,a.beginPath(),a.moveTo(this.column*b,this.row*c),a.lineTo(this.column*b,(this.row+1)*c),a.closePath(),a.stroke()),this.right||(a.strokeStyle=this.rightColor,a.beginPath(),a.moveTo((this.column+1)*b,this.row*c),a.lineTo((this.column+1)*b,(this.row+1)*c),a.closePath(),a.stroke()),this.top||(a.strokeStyle=this.topColor,a.beginPath(),a.moveTo(this.column*b,this.row*c),a.lineTo((this.column+1)*b,this.row*c),a.closePath(),a.stroke()),this.bottom||(a.strokeStyle=this.bottomColor,a.beginPath(),a.moveTo(this.column*b,(this.row+1)*c),a.lineTo((this.column+1)*b,(this.row+1)*c),a.closePath(),a.stroke())},c}),angular.module("mctApp").factory("MazeStore",["$resource",function(a){return a("mazes/:name",{name:"@urlString"})}]),angular.module("mctApp").controller("ClothCtrl",["$scope","Cloth",function(a,b){a.options={rows:15,columns:15},a.initDemo=function(c){a.cloth=new b(c,a.options)},a.reset=function(){a.cloth&&a.cloth.reset(a.options)},a.handleMouseDown=function(b){var c=b.offsetX,d=b.offsetY,e=a.cloth.findClosestPoint(c,d);e.fill="red",e.draw(a.cloth.ctx),console.log(e)},a.handleMouseMove=function(a){console.log(a)},a.handleMouseUp=function(a){console.log(a)}}]),angular.module("mctApp").directive("demo",["$window",function(a){return{templateUrl:"templates/demo.html",restrict:"E",replace:!0,link:function(b,c){function d(){var a=c[0].clientWidth,d=c[0].clientHeight;e=c[0].children[0],e.width=a,e.height=d,b.initDemo(e)}var e;d(),a.onresize=d}}}]),angular.module("mctApp").factory("Cloth",function(){var a,b,c;return a=function(a,b){this.canvas=a,this.reset(b)},a.defaults={rows:15,columns:15,springConstant:10},a.prototype.reset=function(b){b=b||a.defaults,this.rows=b.rows,this.columns=b.columns,this.springConstant=b.springConstant,this.points=[this.rows*this.columns],this.constraints=[],this.width=this.canvas.width,this.offsetWidth=.8*this.width,this.dx=this.offsetWidth/this.columns,this.offsetX=.1*this.width,this.height=this.canvas.height,this.offsetHeight=.6*this.height,this.dy=this.offsetHeight/this.rows,this.offsetY=.1*this.height,this.generatePoints(),this.generateConstraints(),this.ctx=this.canvas.getContext("2d"),this.ctx&&this.draw(this.ctx)},a.prototype.generatePoints=function(){for(var a=0,b=this.columns;b>a;a++)for(var c=0,d=this.rows;d>c;c++)this.addPoint(a,c)},a.prototype.addPoint=function(a,c){this.points[this.getIndex(a,c)]=new b(this,a,c)},a.prototype.generateConstraints=function(){for(var a,b,c=this.springConstant,d=0,e=this.columns;e>d;d++)for(var f=0,g=this.rows;g>f;f++)d>0&&(a=this.points[this.getIndex(d-1,f)],b=this.points[this.getIndex(d,f)],this.addConstraint(a,b,c)),f>0&&(a=this.points[this.getIndex(d,f-1)],b=this.points[this.getIndex(d,f)],this.addConstraint(a,b,c))},a.prototype.addConstraint=function(a,b,d){this.constraints.push(new c(a,b,d))},a.prototype.getIndex=function(a,b){return a+b*this.rows},a.prototype.draw=function(a){this.constraints.forEach(function(b){b.draw(a)}),this.points.forEach(function(b){b.draw(a)})},a.prototype.findClosestPoint=function(a,b){var c,d=1e3,e=null;return this.points.forEach(function(f){c=Math.sqrt(Math.pow(f.x-a,2)+Math.pow(f.y-b,2)),d>c&&(e=f,d=c)}),e},b=function(a,b,c){this.cloth=a,this.column=b,this.row=c,this.fill="black",this.x=this.column*this.cloth.dx+this.cloth.offsetX,this.y=this.row*this.cloth.dy+this.cloth.offsetY},b.prototype.draw=function(a){a.beginPath(),a.fillStyle=this.fill,a.arc(this.x,this.y,3,0,6.28,0),a.closePath(),a.fill()},c=function(a,b,c){this.p1=a,this.p2=b,this.k=c},c.prototype.draw=function(a){a.beginPath(),a.moveTo(this.p1.x,this.p1.y),a.lineTo(this.p2.x,this.p2.y),a.closePath(),a.stroke()},a}),angular.module("mctApp").controller("ChemistryCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").controller("PeriodicTableCtrl",["$scope",function(a){a.elements=[{z:1,element:"H",electronConfig:"(1s1)"},{z:2,element:"He",electronConfig:"(1s2)"},{z:3,element:"Li",electronConfig:"(1s2)(2s1)"},{z:4,element:"Be",electronConfig:"(1s2)(2s2)"},{z:5,element:"B",electronConfig:"(1s2)(2s2)(2p1)"},{z:6,element:"C",electronConfig:"(1s2)(2s2)(2p2)"},{z:7,element:"N",electronConfig:"(1s2)(2s2)(2p3)"},{z:8,element:"O",electronConfig:"(1s2)(2s2)(2p4)"},{z:9,element:"F",electronConfig:"(1s2)(2s2)(2p5)"},{z:10,element:"Ne",electronConfig:"(1s2)(2s2)(2p6)"}]}]),angular.module("mctApp").controller("Mc3Ctrl",["$scope","Vector3","Camera","Mesh","Renderer","World",function(a,b,c,d,e,f){function g(){a.advance(),a.animFrame=window.requestAnimationFrame(g)}a.initDemo=function(g){a.rotX=.02,a.rotY=.01,a.rotZ=0,a.world=new f,a.mesh=new d("cube",8),a.mesh.vertices[0]=new b(1,1,1),a.mesh.vertices[1]=new b(1,-1,1),a.mesh.vertices[2]=new b(-1,1,1),a.mesh.vertices[3]=new b(-1,-1,1),a.mesh.vertices[4]=new b(1,1,-1),a.mesh.vertices[5]=new b(1,-1,-1),a.mesh.vertices[6]=new b(-1,1,-1),a.mesh.vertices[7]=new b(-1,-1,-1),a.mesh.connectVertices(0,1),a.mesh.connectVertices(0,2),a.mesh.connectVertices(2,3),a.mesh.connectVertices(1,3),a.mesh.connectVertices(4,5),a.mesh.connectVertices(4,6),a.mesh.connectVertices(6,7),a.mesh.connectVertices(5,7),a.mesh.connectVertices(0,4),a.mesh.connectVertices(1,5),a.mesh.connectVertices(2,6),a.mesh.connectVertices(3,7),a.world.add(a.mesh),a.camera=new c,a.camera.position.z=20,a.renderer=new e(g),a.renderer.render(a.world,a.camera)},a.toggleAnimation=function(){a.animFrame?(window.cancelAnimationFrame(a.animFrame),a.animFrame=void 0):g()},a.advance=function(){a.world.rotateX(a.rotX),a.world.rotateY(a.rotY),a.world.rotateZ(a.rotZ),a.renderer.render(a.world,a.camera)}}]),angular.module("mctApp").factory("Vector3",function(){var a=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};return a.prototype.mul=function(b){var c=this.x*b,d=this.y*b,e=this.z*b;return new a(c,d,e)},a.prototype.imul=function(a){return this.x*=a,this.y*=a,this.z*=a,this},a.prototype.div=function(b){var c=this.x/b,d=this.y/b,e=this.z/b;return new a(c,d,e)},a.prototype.idiv=function(a){return this.x/=a,this.y/=a,this.z/=a,this},a.prototype.add=function(b){var c=this.x+b.x,d=this.y+b.y,e=this.z+b.z;return new a(c,d,e)},a.prototype.iadd=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},a.prototype.addVectors=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},a.prototype.sub=function(b){var c=this.x-b.x,d=this.y-b.y,e=this.z-b.z;return new a(c,d,e)},a.prototype.isub=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},a.prototype.subVectors=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},a.prototype.dot=function(a){var b=this.x*a.x+this.y*a.y+this.z*a.z;return b},a.prototype.cross=function(b){var c=this.y*b.z-this.z*b.y,d=this.z*b.x-this.x*b.z,e=this.x*b.y-this.y*b.x;return new a(c,d,e)},a.prototype.crossVectors=function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},a.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},a.prototype.length=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a},a.prototype.squaredLength=function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;return a},a.prototype.normalize=function(){var b=this.length();return new a(this.x/b,this.y/b,this.z/b)},a.prototype.zero=function(){return this.x=0,this.y=0,this.z=0,this},a.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},a.prototype.applyProjection=function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},a.prototype.setFromMatrixPosition=function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},a.Zero=function(){return new a(0,0,0)},a.TransformCoordinates=function(b,c){var d=a.Zero(),e=c.elements,f=b.x*e[0]+b.y*e[4]+b.z*e[8]+e[12],g=b.x*e[1]+b.y*e[5]+b.z*e[9]+e[13],h=b.x*e[2]+b.y*e[6]+b.z*e[10]+e[14],i=b.x*e[3]+b.y*e[7]+b.z*e[11]+e[15];return d.x=f/i,d.y=g/i,d.z=h/i,d},a}),angular.module("mctApp").factory("Object3d",["Vector3","Matrix4","Quaternion","Euler",function(a,b,c,d){var e=function(){this.name="",this.parent=void 0,this.children=[],this.position=new a(0,0,0),this.previous=new a(0,0,0),this._rotation=new d,this._quaternion=new c,this.scale=new a(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.matrix=new b,this.matrixWorld=new b,this.matrixWorld.makeRotationFromQuaternion(this.quaternion),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0};return e.prototype={get rotation(){return this._rotation},set rotation(a){this._rotation=a,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(a){this._quaternion=a,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},add:function(a){if(a===this)return console.warn("Cannot add object as child of itself"),void 0;if(a instanceof e){void 0!==a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a);for(var b=this;void 0!==b.parent;)b=b.parent;void 0!==b&&b.addObject(a)}},remove:function(a){var b=this.children.indexOf(a);if(-1!==b){a.parent=void 0,this.children.splice(b,1);for(var c=this;void 0!==c.parent;)c=c.parent;void 0!==c&&c.removeObject(a)}},rotateOnAxis:function(a,b){var d=new c;return d.setFromAxisAngle(a,b),this.quaternion.multiply(d),this},rotateX:function(b){var c=new a(1,0,0);this.rotateOnAxis(c,b)},rotateY:function(b){var c=new a(0,1,0);this.rotateOnAxis(c,b)},rotateZ:function(b){var c=new a(0,0,1);this.rotateOnAxis(c,b)},move:function(a,b,c){this.previous.copy(this.position),this.matrixWorld.translate([a,b,c]),this.position=this.matrixWorld.getPosition()},lookAt:function(a){var c=new b;c.lookAt(a,this.position,this.up),this.quaternion.setFromRotationMatrix(c)},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||a===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateMatrixWorld(a)}},e}]),angular.module("mctApp").factory("World",["Object3d",function(a){var b=function(){a.call(this),this.autoUpdate=!0,this.objectsAdded=[],this.objectsRemoved=[]};return b.prototype=Object.create(a.prototype),b.prototype.addObject=function(a){this.objectsAdded.push(a)},b.prototype.removeObject=function(a){this.objectsRemoved.push(a)},b}]),angular.module("mctApp").factory("Camera",["Vector3","Object3d","Matrix4",function(a,b,c){var d=function(a,d,e,f){b.call(this),this.fov=void 0!==a?a:50,this.aspect=void 0!==d?d:1,this.near=void 0!==e?e:.1,this.far=void 0!==f?f:2e3,this.matrixWorldInverse=new c,this.projectionMatrix=new c,this.updateProjectionMatrix()};return d.prototype=Object.create(b.prototype),d.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(.5*this.fov*Math.PI/180)*this.near,c=-b,d=a*c,e=a*b,f=Math.abs(e-d),g=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*f/this.fullWidth,d+(this.x+this.width)*f/this.fullWidth,b-(this.y+this.height)*g/this.fullHeight,b-this.y*g/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},d}]),angular.module("mctApp").factory("Renderer",["Matrix4","Vector3","Projector","Mesh",function(a,b,c,d){var e=function(b){this.canvas=b,this.width=b.width,this.height=b.height,this.ctx=b.getContext("2d"),this.projector=new c,this.viewMatrix=new a,this.viewProjectionMatrix=new a,this.modelViewProjectionMatrix=new a};return e.prototype.render=function(a,c){this.ctx.clearRect(0,0,this.width,this.height),this.vertices=[],a.autoUpdate===!0&&a.updateMatrixWorld(),void 0===c.parent&&c.updateMatrixWorld(),this.viewMatrix.copy(c.matrixWorldInverse.getInverse(c.matrixWorld)),this.viewProjectionMatrix.multiplyMatrices(c.projectionMatrix,this.viewMatrix);for(var e=0,f=a.children.length;f>e;e++){var g=a.children[e];if(g instanceof d){this.worldMatrix=g.matrixWorld,this.modelViewProjectionMatrix.multiplyMatrices(this.viewProjectionMatrix,g.matrixWorld);for(var h=0,i=g.vertices.length;i>h;h++){var j=new b,k=g.vertices[h];j.copy(k).applyProjection(this.modelViewProjectionMatrix),this.vertices.push(j),this.drawVertex(j)}for(var l=new b,m=new b,n=0,o=g.lines.length;o>n;n++){var p=g.lines[n];l.copy(p.start).applyProjection(this.modelViewProjectionMatrix),m.copy(p.end).applyProjection(this.modelViewProjectionMatrix),this.drawLine(l,m)}}}},e.prototype.drawLine=function(a,b){var c=a.x*this.width+this.width/2,d=a.y*this.height+this.height/2,e=b.x*this.width+this.width/2,f=b.y*this.height+this.height/2;this.ctx.beginPath(),this.ctx.moveTo(c,d),this.ctx.lineTo(e,f),this.ctx.stroke()},e.prototype.drawVertex=function(a){var b=a.x*this.width+this.width/2,c=a.y*this.height+this.height/2;this.ctx.beginPath(),this.ctx.arc(b,c,3,0,6.28,0),this.ctx.closePath(),this.ctx.fill()},e}]),angular.module("mctApp").factory("Mc3",function(){var a=function(){};return a}),angular.module("mctApp").directive("matrix4",function(){return{templateUrl:"templates/matrix4.html",restrict:"E",transclude:!0,scope:{elements:"=data"}}}),angular.module("mctApp").factory("Matrix4",["Vector3","Quaternion",function(a,b){var c=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16);var q=this.elements;q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1};return c.prototype.toString=function(){var a=this.elements,b=[a[0],a[4],a[8],a[12]].join(","),c=[a[1],a[5],a[9],a[13]].join(","),d=[a[2],a[6],a[10],a[14]].join(","),e=[a[3],a[7],a[11],a[15]].join(","),f=[b,c,d,e].join("\n");return f},c.prototype.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},c.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},c.prototype.transpose=function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},c.prototype.copy=function(a){return this.elements.set(a.elements),this},c.prototype.compose=function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},c.prototype.scale=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},c.prototype.multiply=function(a){var b=new c;return b.multiplyMatrices(this,a),b},c.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},c.prototype.multiplyScalar=function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},c.prototype.getInverse=function(a){var b=this.elements,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[12],h=c[1],i=c[5],j=c[9],k=c[13],l=c[2],m=c[6],n=c[10],o=c[14],p=c[3],q=c[7],r=c[11],s=c[15];b[0]=j*o*q-k*n*q+k*m*r-i*o*r-j*m*s+i*n*s,b[4]=g*n*q-f*o*q-g*m*r+e*o*r+f*m*s-e*n*s,b[8]=f*k*q-g*j*q+g*i*r-e*k*r-f*i*s+e*j*s,b[12]=g*j*m-f*k*m-g*i*n+e*k*n+f*i*o-e*j*o,b[1]=k*n*p-j*o*p-k*l*r+h*o*r+j*l*s-h*n*s,b[5]=f*o*p-g*n*p+g*l*r-d*o*r-f*l*s+d*n*s,b[9]=g*j*p-f*k*p-g*h*r+d*k*r+f*h*s-d*j*s,b[13]=f*k*l-g*j*l+g*h*n-d*k*n-f*h*o+d*j*o,b[2]=i*o*p-k*m*p+k*l*q-h*o*q-i*l*s+h*m*s,b[6]=g*m*p-e*o*p-g*l*q+d*o*q+e*l*s-d*m*s,b[10]=e*k*p-g*i*p+g*h*q-d*k*q-e*h*s+d*i*s,b[14]=g*i*l-e*k*l-g*h*m+d*k*m+e*h*o-d*i*o,b[3]=j*m*p-i*n*p-j*l*q+h*n*q+i*l*r-h*m*r,b[7]=e*n*p-f*m*p+f*l*q-d*n*q-e*l*r+d*m*r,b[11]=f*i*p-e*j*p-f*h*q+d*j*q+e*h*r-d*i*r,b[15]=e*j*l-f*i*l+f*h*m-d*j*m-e*h*n+d*i*n;var t=d*b[0]+h*b[4]+l*b[8]+p*b[12];return 0===t?(console.warn("Cannot invert matrix. Determinant is 0 "),this.identity(),this):(this.multiplyScalar(1/t),this)},c.prototype.translate=function(a){var b=this.elements,c=a[0],d=a[1],e=a[2];b[12]=b[0]*c+b[4]*d+b[8]*e+b[12],b[13]=b[1]*c+b[5]*d+b[9]*e+b[13],b[14]=b[2]*c+b[6]*d+b[10]*e+b[14],b[15]=b[3]*c+b[7]*d+b[11]*e+b[15]},c.prototype.getPosition=function(){var b=this.elements,c=b[12],d=b[13],e=b[14];return new a(c,d,e)},c.prototype.setPosition=function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},c.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},c.prototype.makeFrustum=function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},c.prototype.makePerspective=function(a,b,c,d){var e=c*Math.tan(.5*a),f=-e,g=f*b,h=e*b;return this.makeFrustum(g,h,f,e,c,d)},c.prototype.lookAt=function(b,c,d){var e=this.elements,f=a.Zero(),g=a.Zero(),h=a.Zero();return h.subVectors(c,b).normalize(),0===h.length()&&(h.z=1),f.crossVectors(d,h).normalize(),0===f.length()&&(h.x+=1e-4,f.crossVectors(d,h).normalize()),g.crossVectors(h,f).normalize(),e[0]=f.x,e[4]=g.x,e[8]=h.x,e[1]=f.y,e[5]=g.y,e[9]=h.y,e[2]=f.z,e[6]=g.z,e[10]=h.z,this},c.RotationYawPitchRoll=function(a,d,e){var f=new c,g=b.RotationYawPitchRoll(a,d,e);return g.toRotationMatrix(f),f},c.PerspectiveFov=function(a,b,d,e){var f=c.Zero(),g=f.elements,h=1/Math.tan(.5*a);return g[0]=h/b,g[1]=g[2]=g[3]=0,g[5]=h,g[4]=g[6]=g[7]=0,g[8]=g[9]=0,g[10]=-e/(d-e),g[11]=1,g[12]=g[13]=g[15]=0,g[14]=d*e/(d-e),f},c.Zero=function(){var a=new c;return a.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),a},c.Translation=function(a,b,d){var e=new c;return e.set(1,0,0,a,0,1,0,b,0,0,1,d,0,0,0,1),e},c}]),angular.module("mctApp").controller("Matrix4Ctrl",["$scope","Matrix4",function(a,b){a.m1=new b(1,2,0,1,2,1,0,3,2,2,0,1,2,2,3,4),a.m1Inverse=new b,a.m1Inverse.getInverse(a.m1),a.m1.textarea=a.m1.toString(),a.loadMatrix=function(b){var c=a[b],d=[],e=c.textarea.split("\n");return e.forEach(function(a){var b=a.split(",");b.forEach(function(a){d.push(parseFloat(a))})}),c.set.apply(c,d),d},a.m2=new b,a.m2Inverse=new b,a.m2Inverse.getInverse(a.m2),a.m2.textarea=a.m2.toString(),a.m3=new b,a.calculate=function(){a.m3.multiplyMatrices(a.m1,a.m2)},a.calculate1=function(){a.m3.multiplyMatrices(a.m1,a.m1Inverse)}}]),angular.module("mctApp").factory("Mesh",["Object3d",function(a){var b=function(b,c){this.name=b,this.vertices=new Array(c),this.lines=[],a.call(this)};return b.prototype=Object.create(a.prototype),b.prototype.connectVertices=function(a,b){var c=this.vertices[a],d=this.vertices[b];this.lines.push({start:c,end:d})},b}]),angular.module("mctApp").factory("Quaternion",function(){var a=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1};return a.prototype={_updateEuler:function(){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(a){this._x=a,this._updateEuler()},get y(){return this._y},set y(a){this._y=a,this._updateEuler()},get z(){return this._z},set z(a){this._z=a,this._updateEuler()},get w(){return this._w},set w(a){this._w=a,this._updateEuler()}},a.prototype.setFromEuler=function(a,b){var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);
return"XYZ"===a.order&&(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._y=c*d*e-f*g*h),b!==!1&&this._updateEuler(),this},a.prototype.toRotationMatrix=function(a){var b=a.elements,c=this.x*this.x,d=this.y*this.y,e=this.z*this.z,f=this.x*this.y,g=this.z*this.w,h=this.z*this.x,i=this.y*this.w,j=this.y*this.z,k=this.x*this.w;return b[0]=1-2*(d+e),b[1]=2*(f+g),b[2]=2*(h-i),b[3]=0,b[4]=2*(f-g),b[5]=1-2*(e+c),b[6]=2*(j+k),b[7]=0,b[8]=2*(h+i),b[9]=2*(j-k),b[10]=1-2*(d+c),b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,a},a.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)},a.prototype.multiplyQuaternions=function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+f*g+d*i-e*h,this.y=d*j+f*h+e*g-c*i,this.z=e*j+f*i+c*h-d*g,this.w=f*j-c*g-d*h-e*i,this},a.prototype.setFromAxisAngle=function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},a.RotationYawPitchRoll=function(b,c,d){var e=new a(0,0,0,1),f=.5*d,g=.5*c,h=.5*b,i=Math.sin(f),j=Math.cos(f),k=Math.sin(g),l=Math.cos(g),m=Math.sin(h),n=Math.cos(h);return e.x=n*k*j+m*l*i,e.y=m*l*j-n*k*i,e.z=n*l*i-m*k*j,e.w=n*l*j+m*k*i,e},a}),angular.module("mctApp").factory("Projector",["Matrix4","Mesh","Vertex","RenderableObject",function(a,b,c,d){var e=function(){this.objectPool=[],this.objectPoolLength=0,this.objectCount=0,this.vertexPool=[],this.vertexPoolLength=0,this.vertexCount=0,this.viewMatrix=new a,this.viewProjectionMatrix=new a,this.modelViewProjectionMatrix=new a,this.renderData={objects:[],sprites:[],lights:[],elements:[]}};return e.prototype.getObject=function(a){var b=this.getNextObjectInPool();b.id=a.id,b.object=a},e.prototype.getNextObjectInPool=function(){if(this.objectCount===this.objectPoolLength){var a=new d;return this.objectPool.push(a),this.objectPoolLength++,this.objectCount++,a}return this.objectPool[this.objectCount++]},e.prototype.getNextVertexInPool=function(){if(this.vertexCount===this.vertexPoolLength){var a=new c;return this.vertexPool.push(a),this.vertexPoolLength++,this.vertexCount++,a}return this.vertexPool[this.vertexCount++]},e.prototype.projectVertex=function(a){var b=a.position,c=a.positionWorld,d=a.positionScreen;c.copy(b).applyMatrix4(this.modelMatrix),d.copy(c).applyMatrix4(this.viewProjectionMatrix)},e.prototype.projectObject=function(a){a instanceof b&&this.renderData.objects.push(a);for(var c=0,d=a.children.length;d>c;c++)this.projectObject(a.children[c])},e.prototype.projectGraph=function(a){return this.objectCount=0,this.renderData.objects.length=0,this.renderData.sprites.length=0,this.renderData.lights.length=0,this.projectObject(a),this.renderData},e.prototype.projectWorld=function(a,b){return a.autoUpdate===!0&&a.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),this.viewMatrix.copy(b.matrixWorldInverse.getInverse(b.matrixWorld)),this.viewProjectionMatrix.multiplyMatrices(b.projectionMatrix,this.viewMatrix),this.renderData=this.projectGraph(a),this.renderData},e}]),angular.module("mctApp").factory("Vertex",["Vector3","Vector4",function(a,b){var c=function(){this.position=new a,this.positionWorld=new a,this.positionScreen=new b,this.visible=!0};return c.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},c}]),angular.module("mctApp").factory("Vector4",function(){var a=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1};return a.prototype.set=function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d},a.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this},a.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this.w=e[3]*b+e[7]*c+e[11]*d+e[15],this},a}),angular.module("mctApp").factory("RenderableObject",function(){var a=function(){};return a}),angular.module("mctApp").directive("toggle",function(){return{replace:!0,template:'<button class="btn btn-success" ng-click="toggle()">{{text}}</button>',restrict:"E",link:function(a,b,c){a.active=!1,a.text=c.off,a.toggle=function(){a.active?(b.removeClass("btn-danger"),b.addClass("btn-success"),a.text=c.off,a.active=!1):(b.removeClass("btn-success"),b.addClass("btn-danger"),a.text=c.on,a.active=!0),a[c.action]()}}}}),angular.module("mctApp").controller("WorldCtrl",["$scope","Vector3","Camera","Mesh","Renderer","World",function(a,b,c,d,e,f){a.initDemo=function(g){function h(){a.renderer.render(a.world,a.camera)}a.world=new f;var i=new d("cube",8);i.vertices[0]=new b(1,1,1),i.vertices[1]=new b(1,-1,1),i.vertices[2]=new b(-1,1,1),i.vertices[3]=new b(-1,-1,1),i.vertices[4]=new b(1,1,-1),i.vertices[5]=new b(1,-1,-1),i.vertices[6]=new b(-1,1,-1),i.vertices[7]=new b(-1,-1,-1),i.connectVertices(0,1),i.connectVertices(0,2),i.connectVertices(2,3),i.connectVertices(1,3),i.connectVertices(4,5),i.connectVertices(4,6),i.connectVertices(6,7),i.connectVertices(5,7),i.connectVertices(0,4),i.connectVertices(1,5),i.connectVertices(2,6),i.connectVertices(3,7),i.position.x=1,a.world.add(i),i=new d("cube",8),i.vertices[0]=new b(1,1,1),i.vertices[1]=new b(1,-1,1),i.vertices[2]=new b(-1,1,1),i.vertices[3]=new b(-1,-1,1),i.vertices[4]=new b(1,1,-1),i.vertices[5]=new b(1,-1,-1),i.vertices[6]=new b(-1,1,-1),i.vertices[7]=new b(-1,-1,-1),i.connectVertices(0,1),i.connectVertices(0,2),i.connectVertices(2,3),i.connectVertices(1,3),i.connectVertices(4,5),i.connectVertices(4,6),i.connectVertices(6,7),i.connectVertices(5,7),i.connectVertices(0,4),i.connectVertices(1,5),i.connectVertices(2,6),i.connectVertices(3,7),i.position.x=-1,a.world.add(i),i=new d("cube",8),i.vertices[0]=new b(1,1,1),i.vertices[1]=new b(1,-1,1),i.vertices[2]=new b(-1,1,1),i.vertices[3]=new b(-1,-1,1),i.vertices[4]=new b(1,1,-1),i.vertices[5]=new b(1,-1,-1),i.vertices[6]=new b(-1,1,-1),i.vertices[7]=new b(-1,-1,-1),i.connectVertices(0,1),i.connectVertices(0,2),i.connectVertices(2,3),i.connectVertices(1,3),i.connectVertices(4,5),i.connectVertices(4,6),i.connectVertices(6,7),i.connectVertices(5,7),i.connectVertices(0,4),i.connectVertices(1,5),i.connectVertices(2,6),i.connectVertices(3,7),i.position.x=1,i.position.z=-2,a.world.add(i),i=new d("cube",8),i.vertices[0]=new b(1,1,1),i.vertices[1]=new b(1,-1,1),i.vertices[2]=new b(-1,1,1),i.vertices[3]=new b(-1,-1,1),i.vertices[4]=new b(1,1,-1),i.vertices[5]=new b(1,-1,-1),i.vertices[6]=new b(-1,1,-1),i.vertices[7]=new b(-1,-1,-1),i.connectVertices(0,1),i.connectVertices(0,2),i.connectVertices(2,3),i.connectVertices(1,3),i.connectVertices(4,5),i.connectVertices(4,6),i.connectVertices(6,7),i.connectVertices(5,7),i.connectVertices(0,4),i.connectVertices(1,5),i.connectVertices(2,6),i.connectVertices(3,7),i.position.x=-1,i.position.z=-2,a.world.add(i),a.camera=new c,a.camera.position.z=10,a.renderer=new e(g),h(),a.forward=function(){var b=Math.sin(180*a.camera.rotation.y/Math.PI)/a.camera.position.z;a.camera.position.z-=.1,a.camera.position.x+=b,h()},a.back=function(){var b=Math.sin(180*a.camera.rotation.y/Math.PI)/a.camera.position.z;a.camera.position.z+=.1,a.camera.position.x-=b,h()},a.left=function(){a.camera.position.x-=1,h()},a.right=function(){a.camera.position.x+=1,h()},a.lookLeft=function(){a.camera.rotateY(.05),h()},a.lookRight=function(){a.camera.rotateY(-.05),h()}}}]),angular.module("mctApp").factory("Euler",function(){var a=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._order=d||"XYZ",this._quaternion=void 0};return a.prototype={_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(a){this._x=a,this._updateQuaternion()},get y(){return this._y},set y(a){this._y=a,this._updateQuaternion()},get z(){return this._z},set z(a){this._z=a,this._updateQuaternion()},get order(){return this._order},set order(a){this._order=a,this._updateQuaternion()},setFromQuaternion:function(a,b,c){function d(a){return Math.min(Math.max(a,-1),1)}var e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;return b=b||this._order,"XYZ"===b&&(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w))),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+e-f-g)),this._order=b,c!==!1&&this._updateQuaternion(),this}},a}),angular.module("mctApp").controller("SketcherCtrl",["$scope","$routeParams","$filter","Molecule","MoleculeStore","Atom","Bond",function(a,b,c,d,e,f,g){a.molecules=e.query(),a.name="molecule",a.dragging=!1,a.dragStart=void 0,a.atomTool="C",a.bondTool="1",a.selectedBond=void 0,a.selectedBondAngle=void 0,a.mouseTool=void 0,a.bondTypes=["1","2","3","d","s"],a.atoms=["C","H","N","O","P","S","B","Si","F","Cl","Br","I"],a.atomGroups=c("groupBy")(a.atoms,6),a.changeAtomTool=function(b){a.selectedBond&&(a.selectedBond.deselect(),a.molecule.draw()),a.atomTool=b,a.bondTool=a.bondTool?a.bondTool:"1",a.mouseTool=void 0},a.getAtomToolClass=function(b){var c=a.atomTool===b?"active":"";return c},a.changeMouseTool=function(b){a.mouseTool=b,a.atomTool=void 0,a.bondTool=void 0},a.getMouseToolClass=function(b){var c=a.mouseTool===b?"active":"";return c},a.changeBondTool=function(b){a.selectedBond&&(a.selectedBond.deselect(),a.molecule.draw()),a.bondTool=b,a.mouseTool=void 0,a.atomTool=a.atomTool?a.atomTool:"C"},a.getBondToolClass=function(b){var c=a.bondTool===b?"active":"";return c},a.save=function(){var b=a.molecule.generateMolFile();a.moleculeStore?(console.log("update"),a.moleculeStore.name=a.name,a.moleculeStore.molFile=b,a.moleculeStore.$save(),console.log(a.moleculeStore)):(console.log("new molecule"),a.moleculeStore=new e({name:a.name,molFile:b}),a.moleculeStore.$save())},a.newMolecule=function(){a.name="molecule",a.moleculeStore=void 0,a.molecule=new d(a.name,void 0,a.canvas),a.molecule.draw()},a.loadMolecule=function(b){a.moleculeStore=b,a.name=b.name,console.log(b),a.molecule=new d(b.name,b.molFile,a.canvas),a.molecule.draw()},a.initDemo=function(c){a.canvas=c,b.name&&!a.moleculeStore?a.moleculeStore=e.get({name:b.name},function(){a.name=a.moleculeStore.name,a.molecule=new d(a.moleculeStore.name,a.moleculeStore.molFile,a.canvas),a.molecule.draw()}):(a.molecule=a.molecule||new d(a.name,void 0,c),a.molecule.canvas=c,a.molecule.resize(),a.molecule.draw())},a.logMolFile=function(){console.log(a.molecule.generateMolFile())},a.normalize=function(){console.table(a.molecule.normalize())},a.handleMouseDown=function(b){var c=b.offsetX,d=b.offsetY,e=a.molecule;a.selectedBond&&a.selectedBond.deselect(),a.selectedBond=void 0,a.selectedBondAngle&&a.selectedBondAngle.deselect(),a.selectedBondAngle=void 0;var h=e.findClosestObject(c,d,0);if(void 0!==a.mouseTool)"select"===a.mouseTool?h.distance<.05&&h.object instanceof f?(e.changeSelection([h.object]),a.dragging=!0,a.dragStart={x:c,y:d}):h.distance<.05&&h.object instanceof g?(e.selectedBond===h.object&&h.object.increment(),e.changeSelection([h.object])):e.changeSelection([]):"delete"===a.mouseTool&&h.distance<.05&&h.object instanceof f&&h.object.remove();else if(void 0!==a.atomTool){var i,j=0;if("s"===a.bondTool?j=.25:"d"===a.bondTool&&(j=-.25),i=h.object instanceof f&&h.distance<.05?h.object:e.addAtom(a.atomTool,c,d,j,!1),e.selectedAtom&&e.selectedAtom.distanceFrom(c,d,0)<.45){var k=a.bondTool;("s"===a.bondTool||"d"===a.bondTool)&&(k=1),e.selectedAtom.bondTo(i,k)}e.changeSelection([i])}e.draw()},a.handleMouseUp=function(b){var c=b.offsetX,d=b.offsetY,e=a.molecule;e.draw(),a.dragging=!1,a.mouseX=c,a.mouseY=d},a.handleMouseMove=function(b){if(a.molecule){var c=b.offsetX,d=b.offsetY,e=a.molecule;if(a.mouseX=c,a.mouseY=d,a.dragging){var f=(c-a.dragStart.x)/e.workingWidth,g=(d-a.dragStart.y)/e.workingHeight;e.selection.forEach(function(a){a.shift(f,g,0)}),a.dragStart.x=c,a.dragStart.y=d}if(e.selectedAtom&&void 0!==a.atomTool){var h=e.selectedAtom.distanceFrom(c,d,0);h>.45&&e.changeSelection([])}e.draw()}},a.getBondClass=function(b){return a.selectedBond===b?"active":""},a.selectBond=function(b){a.selectedBond&&a.selectedBond.deselect(),a.selectedBondAngle&&a.selectedBondAngle.deselect(),a.selectedBond=b,b.select(),a.molecule.draw()},a.getBondAngleClass=function(b){return a.selectedBondAngle===b?"active":""},a.selectBondAngle=function(b){a.selectedBond&&a.selectedBond.deselect(),a.selectedBondAngle&&a.selectedBondAngle.deselect(),a.selectedBondAngle=b,b.select(),a.molecule.draw()},a.satisfy=function(){for(var b=function(a){a.satisfy()},c=function(a){a.satisfy()},d=0;100>d;d++)a.molecule.bonds.forEach(b),a.molecule.bondAngles.forEach(c);a.molecule.draw()}}]),angular.module("mctApp").factory("Molecule",["Vector3","Atom","Bond",function(a,b,c){var d=function(a,b,c){this.name=a,this.molFile=b,void 0!==c&&(this.canvas=c,this.ctx=this.canvas.getContext("2d"),this.resize()),this.atoms=[],this.bonds=[],this.bondAngles=[],this.bondConstant=.05,this.bondAngleConstant=.0025,this.selectedAtom=void 0,this.selectedBond=void 0,this.selection=[],void 0!==this.molFile&&this.parseMolFile()};return d.prototype.resize=function(){this.canvasWidth=this.canvas.width,this.halfWidth=.5*this.canvasWidth,this.offsetWidth=.1*this.canvasWidth,this.workingWidth=.8*this.canvasWidth,this.canvasHeight=this.canvas.height,this.halfHeight=.5*this.canvasHeight,this.offsetHeight=.1*this.canvasHeight,this.workingHeight=.8*this.canvasHeight,this.aspect=this.canvasWidth/this.canvasHeight},d.prototype.changeSelection=function(a){if(this.selectedAtom=void 0,this.selectedBond=void 0,a.forEach(function(a){a.select()}),this.selection.forEach(function(a){a.deselect()}),this.selection=a,a.forEach(function(a){a.select()}),1===a.length){var d=a[0];d instanceof b?this.selectedAtom=d:d instanceof c&&(this.selectedBond=d)}this.draw()},d.prototype.toNormalCoordinates=function(b,c,d){var e=(b-this.halfWidth)/this.workingWidth,f=(c-this.halfHeight)/this.workingHeight;return new a(e,f,d)},d.prototype.addAtom=function(a,c,d,e,f){var g,h;f===!1?(g=(c-this.halfWidth)/this.workingWidth,h=(d-this.halfHeight)/this.workingHeight):(g=c,h=d);var i=new b(a,g,h,e,this);return this.atoms.push(i),i},d.prototype.addBond=function(a,b,d){var e=new c(a,b,d,this);return this.bonds.push(e),e},d.prototype.findClosestObject=function(a,b,c){var d,e=this.findClosestAtom(a,b,c),f=this.findClosestBond(a,b,c);return d=e.distance<1*f.distance?{object:e.atom,distance:e.distance}:{object:f.bond,distance:f.distance}},d.prototype.findClosestAtom=function(a,b,c){for(var d,e=999,f=this.atoms.length,g=0;f>g;g++){var h=this.atoms[g],i=h.distanceFrom(a,b,c);e>i&&(e=i,d=h)}return{atom:d,distance:e}},d.prototype.findClosestBond=function(a,b,c){for(var d,e=999,f=this.bonds.length,g=this.toNormalCoordinates(a,b,c),h=0;f>h;h++){var i=this.bonds[h],j=i.distanceFrom(g.x,g.y,g.z);e>j&&(e=j,d=i)}return{bond:d,distance:e}},d.prototype.generateMolFile=function(){var a=[];return a.push(this.name),a.push(this.atoms.length+" "+this.bonds.length),this.normalize(),this.atoms.forEach(function(b){a.push([b.element,b.position.x,b.position.y,b.position.z].join(" "))}),this.bonds.forEach(function(b){a.push([b.startAtom.getIndex(),b.endAtom.getIndex(),b.order].join(" "))}),a.join("\n")},d.prototype.parseMolFile=function(){var a=this.molFile.split("\n");this.name=a[0];var b,c,d,e=a[1].split(" "),f=parseInt(e[0],10),g=parseInt(e[1],10);for(d=0;f>d;d++){b=a[d+2],c=b.split(" ");var h=c[0],i=parseFloat(c[1]),j=parseFloat(c[2]),k=parseFloat(c[3]);this.addAtom(h,i,j,k,!0)}for(d=0;g>d;d++){b=a[d+f+2],c=b.split(" ");var l=parseInt(c[0],10),m=this.atoms[l],n=parseInt(c[1],10),o=this.atoms[n],p=parseInt(c[2],10);this.addBond(m,o,p)}this.atoms.forEach(function(a){a.getBondAngles()})},d.prototype.getBoundingBox=function(){var a=this.atoms.map(function(a){return{x:a.position.x,y:a.position.y,z:a.position.z,index:a.index}});a.sort(function(a,b){return a.x-b.x}),this.minX=a[0].x,this.maxX=a[a.length-1].x,a.sort(function(a,b){return a.y-b.y}),this.minY=a[0].y,this.maxY=a[a.length-1].y,a.sort(function(a,b){return a.z-b.z}),this.minZ=a[0].z,this.maxZ=a[a.length-1].z,this.width=this.maxX-this.minX,this.cx=this.minX+this.workingWidth/2,this.height=this.maxY-this.minY,this.cy=this.minY+this.workingHeight/2,this.depth=this.maxZ-this.minZ,this.cz=this.minZ+this.depth/2,this.depth=0===this.depth?1:this.depth},d.prototype.normalize=function(){this.getBoundingBox();var b=this.minX,c=this.minY,d=this.minZ,e=this.height,f=this.width,g=this.depth,h=e/f,i=this.atoms.map(function(i){return i.nx=((i.position.x-b)/f-.5).toFixed(5),i.ny=((i.position.y-c)/e*h-.5).toFixed(5),i.nz=((i.position.z-d)/g-.5).toFixed(5),i.normal=new a(i.nx,i.ny,i.nz),i});return i},d.prototype.draw=function(){var a=this.ctx;a.clearRect(0,0,this.canvas.width,this.canvas.height),this.bonds.forEach(function(b){b.draw(a)}),this.atoms.forEach(function(b){b.draw(a)})},d}]),angular.module("mctApp").factory("MoleculeStore",["$resource",function(a){return a("molecules/:name",{name:"@urlString"})}]),angular.module("mctApp").factory("Atom",["Vector3","BondAngle",function(a,b){var c=function(b,c,d,e,f){this.element=b,this.x=c,this.y=d,this.z=e,this.position=new a(c,d,e),this.molecule=f,this.bonds=[],this.bondAngles=void 0,this.selected=!1,this.getScreenPosition()};return c.prototype.addBondAngle=function(a,c){if(a===c)return!1;for(var d=0,e=this.bondAngles.length;e>d;d++){var f=this.bondAngles[d];if(f.bonds.indexOf(a)>=0&&f.bonds.indexOf(c)>=0)return!1}var g=new b(this,a,c);return this.bondAngles.push(g),this.molecule.bondAngles.push(g),g},c.prototype.getIndex=function(){return this.molecule.atoms.indexOf(this)},c.prototype.getBondAngles=function(){if(void 0===this.bondAngles){this.bondAngles=[];for(var a=0,b=this.bonds.length;b>a;a++)for(var c=0;b>c;c++){var d=this.bonds[a],e=this.bonds[c];this.addBondAngle(d,e)}}},c.prototype.vsper=function(){return this.bonds.length},c.prototype.getScreenPosition=function(){this.screenX=this.position.x*this.molecule.workingWidth+this.molecule.halfWidth,this.screenY=this.position.y*this.molecule.workingHeight+this.molecule.halfHeight},c.prototype.distanceFrom=function(a,b,c){var d=this.molecule.toNormalCoordinates(a,b,c),e=this.position.sub(d);e.z=0;var f=e.length();return f},c.prototype.bondTo=function(a,b){for(var c=0,d=this.bonds.length;d>c;c++){var e=this.bonds[c];if(e.atoms.indexOf(a)>=0)return!1}this.molecule.addBond(this,a,b)},c.prototype.remove=function(){this.molecule.atoms.splice(this.getIndex(),1),this.bonds.forEach(function(a){a.remove()})},c.prototype.select=function(){this.selected=!0},c.prototype.deselect=function(){this.selected=!1},c.prototype.copy=function(){return new c(this.element,this.x,this.y,this.z,this.molecule)},c.prototype.shift=function(a,b,c){return this.position.x+=a,this.position.y+=b,this.position.z+=c,this.getScreenPosition(),this},c.prototype.draw=function(a){this.getScreenPosition(),a.fillStyle="white",a.beginPath(),a.arc(this.screenX,this.screenY,8,0,6.28,0),a.fill(),a.closePath(),a.beginPath(),a.fillStyle=this.selected?"red":"black",a.fillText(this.element,this.screenX-4,this.screenY+5),a.closePath(),a.fill()},c}]),angular.module("mctApp").factory("Bond",function(){var a=function(a,b,c,d){this.startAtom=a,this.startAtom.bonds.push(this),this.endAtom=b,this.endAtom.bonds.push(this),this.order=c,this.molecule=d,this.index=void 0,this.atoms=[this.startAtom,this.endAtom],this.restLength=.25,this.k=this.molecule.bondConstant,this.selected=!1};return a.prototype.getOtherAtom=function(a){return-1===this.atoms.indexOf(a)?!1:a===this.startAtom?this.endAtom:this.startAtom},a.prototype.getTopAtom=function(){return this.startAtom.position.z-this.endAtom.position.z>0?this.startAtom:this.endAtom},a.prototype.getBottomAtom=function(){return this.getOtherAtom(this.getTopAtom())},a.prototype.select=function(){this.selected=!0},a.prototype.deselect=function(){this.selected=!1},a.prototype.satisfy=function(){var a=this.startAtom.position.sub(this.endAtom.position),b=(a.length()-this.restLength)/this.restLength;this.startAtom.position.isub(a.mul(this.k*b)),this.endAtom.position.iadd(a.mul(this.k*b))},a.prototype.length=function(){var a=this.startAtom.position.sub(this.endAtom.position).length();return a},a.prototype.distanceFrom=function(a,b,c){var d=(this.startAtom.x-this.endAtom.x)/2+this.endAtom.x,e=(this.startAtom.y-this.endAtom.y)/2+this.endAtom.y,f=(this.startAtom.z-this.endAtom.z)/2+this.endAtom.z,g=d-a,h=e-b,i=f-c;0===c&&(i=0);var j=Math.sqrt(g*g+h*h+i*i);return j},a.prototype.remove=function(){var a=this.molecule.bonds.indexOf(this);this.molecule.bonds.splice(a,1)},a.prototype.draw=function(a){var b=this.getTopAtom();b.getScreenPosition();var c=this.getBottomAtom();c.getScreenPosition(),a.beginPath(),a.strokeStyle=this.selected?"red":"black";for(var d=1;d<=this.order;d++)a.moveTo(b.screenX+(2*d-1),b.screenY+2*d-1),a.lineTo(c.screenX+2*d-1,c.screenY+2*d-1);a.closePath(),a.stroke()},a.prototype.increment=function(){this.order=this.order++%3+1,console.log(this.order)},a}),angular.module("mctApp").filter("groupBy",function(){return function(a,b){for(var c,d=[],e=0;e<a.length;e++)e%b===0&&(c=[],d.push(c)),c.push(a[e]);return d}}),angular.module("mctApp").controller("RendererCtrl",["$scope","$window","$location","$routeParams","MoleculeStore","Molecule","Vector3","Camera","Mesh","Renderer","World",function(a,b,c,d,e,f,g,h,i,j,k){function l(){a.world.rotateX(a.rotX),a.world.rotateY(a.rotY),a.world.rotateZ(a.rotZ),a.renderer.render(a.world,a.camera),a.animFrame=b.requestAnimationFrame(l)}a.molecules=e.query(),a.rotX=.02,a.rotY=0,a.rotZ=.02,a.sketcher=function(){a.molecule&&c.path("chemistry/sketcher/"+a.moleculeStore.urlString)},a.initDemo=function(b){a.molecule||(a.renderer=new j(b),d.name&&e.get({name:d.name},function(b){a.loadMolecule(b)}))},a.camera=new h,a.camera.position.z=-15,a.toggleAnimation=function(){a.animFrame?(b.cancelAnimationFrame(a.animFrame),a.animFrame=void 0):a.animFrame=b.requestAnimationFrame(l)},a.handleKeyPress=function(a){console.log(a)},a.getMoleculeClass=function(b){return b.urlString===d.name?"active":a.moleculeStore===b?"active":""},a.deleteMolecule=function(b){console.log(b);var c=window.confirm("Are you sure?");console.log(c),c&&(b.$delete(),a.molecules=e.query())},a.loadMolecule=function(b){a.animFrame&&window.cancelAnimationFrame(a.animFrame),a.moleculeStore=b,d.name=b.urlString,a.molecule=new f(b.name,b.molFile,void 0),a.molecule.getBoundingBox(),a.world=new k,a.world.x=a.molecule.cx,a.world.y=a.molecule.cy,a.world.z=a.molecule.cz;var c,e,h=new i(a.molecule.name,a.molecule.atoms.length+1);for(c=0,e=a.molecule.atoms.length;e>c;c++){var j=a.molecule.atoms[c];h.vertices[c]=j.position}for(h.vertices[a.molecule.atoms.length]=new g(a.molecule.cx,a.molecule.cy,a.molecule.cz),c=0,e=a.molecule.bonds.length;e>c;c++){var l=a.molecule.bonds[c];h.connectVertices(l.startAtom.getIndex(),l.endAtom.getIndex())}a.world.add(h),a.renderer.render(a.world,a.camera)}}]),angular.module("mctApp").factory("BondAngle",function(){var a={2:180,3:120,4:109.5},b={2:1,3:2*Math.PI/3,4:109.5*Math.PI/180},c=function(c,d,e){this.name="foo",this.atom=c,this.molecule=this.atom.molecule,this.bonds=[d,e],this.ideal=a[this.atom.vsper()],this.idealRad=b[this.atom.vsper()],this.b1=d,this.a1=this.b1.getOtherAtom(this.atom),this.b2=e,this.a2=this.b2.getOtherAtom(this.atom),this.k=this.molecule.bondAngleConstant};return c.prototype.getAngle=function(){var a=this.a1.position.sub(this.atom.position),b=this.a2.position.sub(this.atom.position),c=a.dot(b),d=c/(a.length()*b.length()),e=180*Math.acos(d)/Math.PI;return e},c.prototype.getRad=function(){var a=this.getAngle();return a*Math.PI/180},c.prototype.satisfy=function(){var a=this.a1.position.sub(this.a2.position).normalize(),b=(this.getAngle()-this.ideal)/this.ideal;this.a1.position.isub(a.mul(b*this.k)),this.a2.position.iadd(a.mul(b*this.k))},c.prototype.select=function(){this.b1.select(),this.b2.select()},c.prototype.deselect=function(){this.b1.deselect(),this.b2.deselect()},c}),angular.module("mctApp").controller("WebGLCtrl",["$scope","Matrix4",function(a,b){function c(){k.pMatrixUniform=j.getUniformLocation(k,"uPMatrix"),k.mvMatrixUniform=j.getUniformLocation(k,"uMVMatrix")}function d(){j.uniformMatrix4fv(k.pMatrixUniform,!1,p.elements),j.uniformMatrix4fv(k.mvMatrixUniform,!1,o.elements)}function e(){j.clearColor(.1,.5,.1,1),j.clear(j.COLOR_BUFFER_BIT),j.enable(j.DEPTH_TEST),j.viewport(0,0,a.canvas.width,a.canvas.height),p.makePerspective(45,a.canvas.width/a.canvas.height,.1,100),o=b.Translation(0,0,n)}function f(){var a=document.getElementById("shader-fs").innerHTML,b=document.getElementById("shader-vs").innerHTML;m=g(b,j.VERTEX_SHADER),l=g(a,j.FRAGMENT_SHADER),k=j.createProgram(),j.attachShader(k,m),j.attachShader(k,l),j.linkProgram(k),j.getProgramParameter(k,j.LINK_STATUS)||console.warn("Unable to initialize shaders"),j.useProgram(k)}function g(a,b){var c=j.createShader(b);return j.shaderSource(c,a),j.compileShader(c),j.getShaderParameter(c,j.COMPILE_STATUS)||console.warn("Error compiling shader: "+j.getShaderInfoLog(c)),c}function h(){var a=[0,0,1,1,1,1,0,0,1,0,0,1,0,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1];u=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,u),j.bufferData(j.ARRAY_BUFFER,new Float32Array(a),j.STATIC_DRAW);var b=[0,0,0,1,0,0,2,0,0,.5,1,0,1.5,1,0,1,2,0,0,0,-2,1,0,-2,2,0,-2,.5,1,-2,1.5,1,-2,1,2,-2];r=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,r),j.bufferData(j.ARRAY_BUFFER,new Float32Array(b),j.STATIC_DRAW);var c=[0,1,3,1,3,4,1,2,4,3,4,5,6,7,9,7,9,10,7,8,10,9,10,11,0,3,6,3,6,9,3,5,9,5,9,11,2,4,8,4,8,10,4,5,10,5,10,11,0,6,8,8,2,0];s=j.createBuffer(),s.numberVertexPoints=c.length,j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,s),j.bufferData(j.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),j.STATIC_DRAW)}function i(){q=j.getAttribLocation(k,"aVertexPosition"),j.enableVertexAttribArray(q),j.bindBuffer(j.ARRAY_BUFFER,r),j.vertexAttribPointer(q,3,j.FLOAT,!1,0,0),t=j.getAttribLocation(k,"aVertexColor"),j.enableVertexAttribArray(t),j.bindBuffer(j.ARRAY_BUFFER,u),j.vertexAttribPointer(t,3,j.FLOAT,!1,0,0),j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,s),j.drawElements(j.TRIANGLES,s.numberVertexPoints,j.UNSIGNED_SHORT,0)}var j=null,k=null,l=null,m=null,n=-7,o=new b,p=new b,q=null,r=null,s=null,t=null,u=null;a.forward=function(){n+=1},a.back=function(){n-=1},a.initDemo=function(b){a.canvas=b;try{j=b.getContext("webgl")||b.getContext("experimental-webgl")}catch(g){}j?(f(),h(),c(),function k(){e(),d(),i(),window.requestAnimationFrame(k,a.canvas)}(),i()):console.alert("Browser fail!")}}]),angular.module("mctApp").controller("GrapherCtrl",["$scope",function(a){a.formula1=function(a){return Math.sin(a)}}]),angular.module("mctApp").directive("graph",["$window",function(a){return{templateUrl:"templates/graph.html",restrict:"E",replace:!0,transclude:!0,link:function(b,c,d){function e(){for(var a=[],b=u,c=[],e=parseFloat(d.increment);v>=b;)c.push(b),b+=e;return d.rangeY?(t=d.rangeY.match(s),j=t[1],k=t[2]):(j=1e4,k=-1e4),c.forEach(function(b){var c=r(b);j>c&&(j=c),c>k&&(k=c),a.push({x:b,y:c})}),k*=3,j*=3,x=k-j,a}function f(){r=b[d.func],l=c[0].clientWidth,m=.67*l,p.width=l,p.height=m,q=p.getContext("2d"),n=l/2,o=m/2,i()}function g(a){return{x:a.x/w*l+n,y:a.y/x*m+o}}function h(){q.beginPath(),q.strokeStyle="black",q.moveTo(n,0),q.lineTo(n,m),q.stroke(),q.beginPath(),q.strokeStyle="black",q.moveTo(0,o),q.lineTo(l,o),q.stroke()}function i(){q.clearRect(0,0,l,m);var a=e();h();var b=a.map(g);q.beginPath(),q.strokeStyle="red",q.lineWidth=2,q.moveTo(b[0].x,b[0].y);for(var c=1,d=b.length;d>c;c++){var f=b[c];q.lineTo(f.x,f.y)}q.stroke()}var j,k,l=c[0].clientWidth,m=c[0].clientHeight,n=l/2,o=m/2,p=c[0].children[1],q=p.getContext("2d"),r=b[d.func],s=/\[(\-?\d+\.?\d*)\,\s*(\-?\d+\.?\d*)\]/,t=d.rangeX.match(s),u=parseFloat(t[1]),v=parseFloat(t[2]),w=v-u,x=1;f(),a.onresize=f,b.$watch("graphDirty",function(){i(),b.graphDirty=!1})}}}]),angular.module("mctApp").controller("GLWorldCtrl",["$scope","Matrix4","Camera","World",function(a,b,c,d){function e(){m.pMatrixUniform=l.getUniformLocation(m,"uPMatrix"),m.vMatrixUniform=l.getUniformLocation(m,"uVMatrix"),m.mMatrixUniform=l.getUniformLocation(m,"uMMatrix")}function f(){l.uniformMatrix4fv(m.pMatrixUniform,!1,r.elements),l.uniformMatrix4fv(m.vMatrixUniform,!1,q.elements),l.uniformMatrix4fv(m.mMatrixUniform,!1,p.elements)}function g(){l.clearColor(.4,.4,.4,1),l.clear(l.COLOR_BUFFER_BIT),l.enable(l.DEPTH_TEST),l.viewport(0,0,a.canvas.width,a.canvas.height),a.camera.updateMatrixWorld(!0),a.camera.matrixWorldInverse.getInverse(a.camera.matrixWorld),r=a.camera.projectionMatrix,q=a.camera.matrixWorldInverse,p=a.world.matrixWorld}function h(){var a=document.getElementById("shader-fs").innerHTML,b=document.getElementById("shader-vs").innerHTML;o=i(b,l.VERTEX_SHADER),n=i(a,l.FRAGMENT_SHADER),m=l.createProgram(),l.attachShader(m,o),l.attachShader(m,n),l.linkProgram(m),l.getProgramParameter(m,l.LINK_STATUS)||console.warn("Unable to initialize shaders"),l.useProgram(m)}function i(a,b){var c=l.createShader(b);return l.shaderSource(c,a),l.compileShader(c),l.getShaderParameter(c,l.COMPILE_STATUS)||console.warn("Error compiling shader: "+l.getShaderInfoLog(c)),c}function j(){var a=[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0];v=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,v),l.bufferData(l.ARRAY_BUFFER,new Float32Array(a),l.STATIC_DRAW);var b=[-1,-1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,1,1,-1,-1,1,1,-1];t=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,t),l.bufferData(l.ARRAY_BUFFER,new Float32Array(b),l.STATIC_DRAW);var c=[0,1,2,1,2,3,4,5,6,5,6,7,2,3,6,6,7,3];u=l.createBuffer(),u.numberVertexPoints=c.length,console.log(u.numberVertexPoints),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,u),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),l.STATIC_DRAW)}function k(){s=l.getAttribLocation(m,"aVertexPosition"),l.enableVertexAttribArray(s),l.bindBuffer(l.ARRAY_BUFFER,t),l.vertexAttribPointer(s,3,l.FLOAT,!1,0,0),w=l.getAttribLocation(m,"aVertexColor"),l.enableVertexAttribArray(w),l.bindBuffer(l.ARRAY_BUFFER,v),l.vertexAttribPointer(w,3,l.FLOAT,!1,0,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,u),l.drawElements(l.TRIANGLES,u.numberVertexPoints,l.UNSIGNED_SHORT,0)}var l=null,m=null,n=null,o=null,p=new b,q=new b,r=new b,s=null,t=null,u=null,v=null,w=null;a.lookLeft=function(){a.camera.rotateY(.15)},a.lookRight=function(){a.camera.rotateY(-.15)},a.forward=function(){a.camera.position.z-=1},a.back=function(){a.camera.position.z+=1},a.left=function(){a.camera.position.x-=1},a.right=function(){a.camera.position.x+=1},a.initDemo=function(b){a.canvas=b;try{l=b.getContext("webgl")||b.getContext("experimental-webgl")}catch(i){}l?(a.animFrame&&window.cancelAnimationFrame(a.animFrame),a.camera=new c(45,a.canvas.width/a.canvas.height,.1,100),a.camera.position.x=.01,a.camera.position.z=4,a.world=new d,h(),j(),e(),function m(){g(),f(),k(),a.animFrame=window.requestAnimationFrame(m,a.canvas)}(),k()):console.alert("Browser fail!")}}]),angular.module("mctApp").controller("TestMatrixCtrl",["$scope","Matrix4","Matrix3",function(a,b,c){a.m1=new c(2,4,5,1,2,4,3,1,4),a.m1t=a.m1.clone().transpose(),a.m1i=a.m1.clone().invert(),a.m2=mat3.create(),a.m2t=mat3.create(),a.m2i=mat3.create(),mat3.copy(a.m2,a.m1.elements),mat3.transpose(a.m2t,a.m2),mat3.invert(a.m2i,a.m2)}]),angular.module("mctApp").factory("GLRenderer",["Matrix4","Matrix3","Wall",function(a,b,c){var d,e,f=function(c,e,f){this.canvas=c,this.width=c.width,this.height=c.height,this.bufferGroups=[],this.lineWidth=3,d=c.getContext("webgl")||c.getContext("experimental-webgl"),d&&(this.pMatrix=new a,this.vMatrix=new a,this.mMatrix=new a,this.mvMatrix=new a,this.normalMatrix=new b,this.vsSource=f,this.fsSource=e)};return f.prototype.getMatrixUniforms=function(){e.pMatrixUniform=d.getUniformLocation(e,"uPMatrix"),e.vMatrixUniform=d.getUniformLocation(e,"uVMatrix"),e.mMatrixUniform=d.getUniformLocation(e,"uMMatrix"),e.mvMatrixUniform=d.getUniformLocation(e,"uMVMatrix"),e.normalMatrixUniform=d.getUniformLocation(e,"uNormalMatrix")},f.prototype.setMatrixUniforms=function(){d.uniformMatrix4fv(e.pMatrixUniform,!1,this.pMatrix.elements),d.uniformMatrix4fv(e.vMatrixUniform,!1,this.vMatrix.elements),d.uniformMatrix4fv(e.mMatrixUniform,!1,this.mMatrix.elements),d.uniformMatrix4fv(e.mvMatrixUniform,!1,this.mvMatrix.elements),d.uniformMatrix3fv(e.normalMatrixUniform,!1,this.normalMatrix.elements)
},f.prototype.initShaders=function(){this.vertexShader=this.makeShader(this.vsSource,d.VERTEX_SHADER),this.fragmentShader=this.makeShader(this.fsSource,d.FRAGMENT_SHADER),e=d.createProgram(),d.attachShader(e,this.vertexShader),d.attachShader(e,this.fragmentShader),d.linkProgram(e),d.getProgramParameter(e,d.LINK_STATUS)||console.warn("Unable to initialize shaders"),d.useProgram(e)},f.prototype.makeShader=function(a,b){var c=d.createShader(b);return d.shaderSource(c,a),d.compileShader(c),d.getShaderParameter(c,d.COMPILE_STATUS)||console.warn("Error compiling shader: "+d.getShaderInfoLog(c)),c},f.prototype.setupWorld=function(){var a=this.bufferGroups;this.world.children.forEach(function(b){if(b instanceof c){var e=b.getGLInfo(),f=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,f),d.bufferData(d.ARRAY_BUFFER,new Float32Array(e.colors),d.STATIC_DRAW);var g=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,g),d.bufferData(d.ARRAY_BUFFER,new Float32Array(e.vertices),d.STATIC_DRAW);var h=d.createBuffer();h.numberVertexPoints=e.indices.length,d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),d.STATIC_DRAW);var i=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,i),d.bufferData(d.ARRAY_BUFFER,new Float32Array(e.normals),d.STATIC_DRAW);var j=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,j),d.bufferData(d.ARRAY_BUFFER,new Float32Array(e.lineColors),d.STATIC_DRAW);var k=d.createBuffer();k.numberVertexPoints=e.lineIndices.length,d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,k),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.lineIndices),d.STATIC_DRAW),a.push({color:f,vertex:g,index:h,normal:i,lineColor:j,lineIndex:k})}})},f.prototype.drawWorld=function(){for(var a=0,b=this.bufferGroups.length;b>a;a++){var c=this.bufferGroups[a],f=d.getAttribLocation(e,"aVertexPosition");d.enableVertexAttribArray(f),d.bindBuffer(d.ARRAY_BUFFER,c.vertex),d.vertexAttribPointer(f,3,d.FLOAT,!1,0,0);var g=d.getAttribLocation(e,"aVertexColor");d.enableVertexAttribArray(g),d.bindBuffer(d.ARRAY_BUFFER,c.color),d.vertexAttribPointer(g,3,d.FLOAT,!1,0,0);var h=d.getAttribLocation(e,"aVertexNormal");d.enableVertexAttribArray(h),d.bindBuffer(d.ARRAY_BUFFER,c.normal),d.vertexAttribPointer(h,3,d.FLOAT,!1,0,0),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c.index),d.drawElements(d.TRIANGLES,c.index.numberVertexPoints,d.UNSIGNED_SHORT,0),g=d.getAttribLocation(e,"aVertexColor"),d.enableVertexAttribArray(g),d.bindBuffer(d.ARRAY_BUFFER,c.lineColor),d.vertexAttribPointer(g,3,d.FLOAT,!1,0,0),d.lineWidth(this.lineWidth),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c.lineIndex),d.drawElements(d.LINES,c.lineIndex.numberVertexPoints,d.UNSIGNED_SHORT,0)}},f.prototype.drawScene=function(){var a=d.getAttribLocation(e,"aVertexPosition");d.enableVertexAttribArray(a),d.bindBuffer(d.ARRAY_BUFFER,this.roomVerticeBuffer),d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);var b=d.getAttribLocation(e,"aVertexColor");d.enableVertexAttribArray(b),d.bindBuffer(d.ARRAY_BUFFER,this.roomColorBuffer),d.vertexAttribPointer(b,3,d.FLOAT,!1,0,0),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.roomVerticesIndexBuffer),d.drawElements(d.TRIANGLES,this.roomVerticesIndexBuffer.numberVertexPoints,d.UNSIGNED_SHORT,0)},f.prototype.setupWebGL=function(){d.clearColor(.8,.8,.8,1),d.clear(d.COLOR_BUFFER_BIT),d.enable(d.DEPTH_TEST),d.viewport(0,0,this.width,this.height),this.camera.updateMatrixWorld(!0),this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld),this.world.updateMatrixWorld(!0),this.pMatrix=this.camera.projectionMatrix,this.vMatrix=this.camera.matrixWorldInverse,this.mMatrix=this.world.matrixWorld,this.mvMatrix.multiplyMatrices(this.mMatrix,this.vMatrix),this.normalMatrix.getInverse(this.mvMatrix).transpose()},f.prototype.render=function(a,b){this.world!==a&&(console.log("changed world"),this.camera=b,this.world=a,this.initShaders(),this.setupWorld(),this.getMatrixUniforms()),this.setupWebGL(),this.setMatrixUniforms(),this.drawWorld()},f}]),angular.module("mctApp").controller("Mc3GLCtrl",["$scope","GLRenderer","Camera","World","Wall",function(a,b,c,d,e){a.lookLeft=function(){a.camera.rotateY(.15)},a.lookRight=function(){a.camera.rotateY(-.15)},a.forward=function(){a.camera.move(0,0,-.3)},a.back=function(){a.camera.move(0,0,.3)},a.left=function(){a.camera.move(-.3,0,0)},a.right=function(){a.camera.move(.3,0,0)},a.world=new d;var f=new e([0,0,-1],[0,0,1],[1,0,0],2,2,[.5,.5,.5]);a.world.add(f),f=new e([1,0,0],[-1,0,0],[0,1,0],2,2,[.5,.5,.5]),a.world.add(f),f=new e([-1,0,0],[1,0,0],[0,1,0],2,2,[.5,.5,.5]),a.world.add(f),a.initDemo=function(d){a.animFrame&&window.cancelAnimationFrame(a.animFrame),a.camera||(a.camera=new c(45,d.width/d.height,.1,100),a.camera.position.z=4);var e=document.getElementById("shader-fs").innerHTML,f=document.getElementById("shader-vs").innerHTML;a.renderer=new b(d,e,f),function g(){a.renderer.render(a.world,a.camera),a.animFrame=window.requestAnimationFrame(g)}()}}]),angular.module("mctApp").factory("Wall",["Object3d","Vector3",function(a,b){var c=function(c,d,e,f,g,h){this.center=new b(c[0],c[1],c[2]),this.normal=new b(d[0],d[1],d[2]).normalize(),this.tangent=new b(e[0],e[1],e[2]).normalize(),this.width=f,this.halfWidth=f/2,this.height=g,this.halfHeight=g/2,this.color=h,this.getVertices(),a.call(this)};return c.prototype=Object.create(a.prototype),c.prototype.getGLInfo=function(){var a=[];this.vertices.forEach(function(b){a.push(b.x),a.push(b.y),a.push(b.z)});var b=this.color.concat(this.color).concat(this.color).concat(this.color),c=[0,1,2,0,2,3],d=[];d.push(this.normal.x,this.normal.y,this.normal.z),d.push(this.normal.x,this.normal.y,this.normal.z),d.push(this.normal.x,this.normal.y,this.normal.z),d.push(this.normal.x,this.normal.y,this.normal.z);var e=[0,0,0,0,0,0,0,0,0,0,0,0],f=[0,1,1,2,2,3,3,0];return{vertices:a,colors:b,indices:c,normals:d,lineColors:e,lineIndices:f}},c.prototype.getVertices=function(){var a=this.normal.cross(this.tangent).normalize(),b=this.normal.cross(a).normalize();a.imul(-1*this.halfHeight),b.imul(-1*this.halfWidth);var c=this.center.sub(b).isub(a),d=this.center.add(b).isub(a),e=this.center.add(b).iadd(a),f=this.center.sub(b).iadd(a),g=[c,d,e,f];return this.vertices=g,g},c}]),angular.module("mctApp").factory("Matrix3",function(){var a=function(a,b,c,d,e,f,g,h,i){this.elements=new Float32Array(9),this.set(void 0!==a?a:1,b||0,c||0,d||0,void 0!==e?e:1,f||0,g||0,h||0,void 0!==i?i:1)};return a.prototype.set=function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this},a.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},a.prototype.copy=function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]),this},a.prototype.fromMatrix4=function(a){var b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this},a.prototype.multiplyScalar=function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},a.prototype.getInverse=function(a){var b=a.elements,c=this.elements;c[0]=b[10]*b[5]-b[6]*b[9],c[1]=-b[10]*b[1]+b[2]*b[9],c[2]=b[6]*b[1]-b[2]*b[5],c[3]=-b[10]*b[4]+b[6]*b[8],c[4]=b[10]*b[0]-b[2]*b[8],c[5]=-b[6]*b[0]+b[2]*b[4],c[6]=b[9]*b[4]-b[5]*b[8],c[7]=-b[9]*b[0]+b[1]*b[8],c[8]=b[5]*b[0]-b[1]*b[4];var d=b[0]*c[0]+b[1]*c[3]+b[2]*c[6];return 0===d?(console.warn("Fail. Determinant = 0"),this.identity(),this):(this.multiplyScalar(1/d),this)},a.prototype.invert=function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=-j*e+g*h,m=i*e-f*h,n=b*k+c*l+d*m;return n?(n=1/n,a[0]=k*n,a[1]=(-j*c+d*i)*n,a[2]=(g*c-d*f)*n,a[3]=l*n,a[4]=(j*b-d*h)*n,a[5]=(-g*b+d*e)*n,a[6]=m*n,a[7]=(-i*b+c*h)*n,a[8]=(f*b-c*e)*n,this):null},a.prototype.transpose=function(){var a=this.elements,b=a[1],c=a[2],d=a[5];return a[1]=a[3],a[2]=a[6],a[3]=b,a[5]=a[7],a[6]=c,a[7]=d,this},a.prototype.clone=function(){var b=this.elements;return new a(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8])},a}),angular.module("mctApp").directive("matrix3",function(){return{templateUrl:"templates/matrix3.html",restrict:"E",transclude:!0,scope:{elements:"=data"}}}),angular.module("mctApp").controller("MazeGLCtrl",["$scope","GLRenderer","Camera","World","Wall","MazeStore",function(a,b,c,d,e,f){function g(b){b.cells.forEach(function(c){var d,f=2*c.row,g=2*c.column,h=[.5,.5,.5],i=[.1,.1,.1];c.row===b.start.row&&c.column===b.start.column&&(i=[1,0,0]),c.row===b.end.row&&c.column===b.end.column&&(i=[0,1,0]),d=new e([f,-1,g],[0,1,0],[0,0,1],2,2,i),a.world.add(d),c.top||(d=new e([f-1,0,g],[-1,0,0],[0,1,0],2,2,h),a.world.add(d)),c.bottom||(d=new e([f+1,0,g],[-1,0,0],[0,1,0],2,2,h),a.world.add(d)),c.left||(d=new e([f,0,g-1],[0,0,-1],[1,0,0],2,2,h),a.world.add(d)),c.right||(d=new e([f,0,g+1],[0,0,-1],[1,0,0],2,2,h),a.world.add(d))}),h()}function h(){a.renderer.render(a.world,a.camera),a.animFrame=window.requestAnimationFrame(h)}var i,j;a.handleMouseDown=function(a){i=a.x,j=a.y},a.handleMouseUp=function(){i=null,j=null},a.handleMouseMove=function(b){if(a.canvas.focus(),i&&j){var c=i-b.x;Math.abs(c)<20&&a.camera.rotateY(c/50),i=b.x,j=b.y}},a.handleKeyPress=function(b){switch(b.keyCode){case 87:a.forward();break;case 65:a.left();break;case 83:a.back();break;case 68:a.right()}},a.lookLeft=function(){a.camera.rotateY(.15)},a.lookRight=function(){a.camera.rotateY(-.15)},a.forward=function(){a.camera.move(0,0,-.5)},a.back=function(){a.camera.move(0,0,.5)},a.left=function(){a.camera.move(-.3,0,0)},a.right=function(){a.camera.move(.3,0,0)},a.world=new d,a.initDemo=function(d){a.canvas=d,a.animFrame&&window.cancelAnimationFrame(a.animFrame),a.camera||(a.camera=new c(45,d.width/d.height,.1,100),a.camera.position.y=.25,a.camera.position.z=1),a.maze||(a.maze=f.get({name:"big"},function(a){var b=JSON.parse(a.config);g(b)}));var e=document.getElementById("shader-fs").innerHTML,h=document.getElementById("shader-vs").innerHTML;a.renderer=new b(d,e,h),a.renderer.lineWidth=2}}]),angular.module("mctApp").controller("CubeCtrl",["$scope","GLRenderer","Camera","World","Wall",function(a,b,c,d,e){a.world=new d;var f=new e([0,0,-1],[0,0,-1],[1,0,0],2,2,[.5,.5,.5]);a.world.add(f);var g=new e([0,0,1],[0,0,1],[1,0,0],2,2,[.5,.5,.5]);a.world.add(g);var h=new e([-1,0,0],[-1,0,0],[0,1,0],2,2,[.5,.5,.5]);a.world.add(h);var i=new e([1,0,0],[1,0,0],[0,1,0],2,2,[.5,.5,.5]);a.world.add(i),a.initDemo=function(d){a.canvas=d,a.camera||(a.camera=new c(45,d.width/d.height,.1,100),a.camera.position.z=4);var e=document.getElementById("shader-fs").innerHTML,f=document.getElementById("shader-vs").innerHTML;a.renderer=new b(d,e,f),a.renderer.lineWidth=1,function g(){a.world.rotateY(.015),a.renderer.render(a.world,a.camera),a.animFrame=window.requestAnimationFrame(g)}()}}]),angular.module("mctApp").controller("AudioCtrl",["$scope","$window",function(a,b){a.frequency=440;var c=new b.webkitAudioContext,d=c.createOscillator();d.type=0,d.frequency.value=a.frequency;var e=c.createGain();e.gain.value=0,d.connect(e),e.connect(c.destination),d.start(0),a.$watch("frequency",function(){d.frequency.value=a.frequency,a.graphDirty=!0}),a.audioFormula=function(b){return Math.sin(b*a.frequency)},a.togglePlay=function(){e.gain.value=a.active?1:0}}]);